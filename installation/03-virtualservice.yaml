# ArgoCD VirtualService Configuration
# Routes traffic from Istio Gateway to ArgoCD server
#
# Before applying:
# 1. Replace "argocd.yourdomain.com" with your actual domain
# 2. Ensure Gateway is created first (02-gateway.yaml)
#
# Apply with:
# kubectl apply -f 03-virtualservice.yaml
#
# Verify with:
# kubectl get virtualservice -n argocd

---
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: argocd-virtualservice
  namespace: argocd
spec:
  hosts:
  - "argocd.yourdomain.com"  # ⚠️ CHANGE THIS to your domain
  gateways:
  - argocd-gateway  # References the Gateway created in 02-gateway.yaml
  tls:
  - match:
    - port: 443
      sniHosts:
      - "argocd.yourdomain.com"  # ⚠️ CHANGE THIS to your domain
    route:
    - destination:
        host: argocd-server  # ArgoCD server service
        port:
          number: 443
